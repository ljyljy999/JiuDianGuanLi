
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>酒店管理系统</title>

    <link href="/public/css/bootstrap.min.css" rel="stylesheet">
    <link href="/public/css/dashboard.css" rel="stylesheet">
    <!-- FONT AWESOME ICONS  -->
    <link href="/public/css/font-awesome.css" rel="stylesheet" />
    <!-- CUSTOM STYLE  -->
    <link href="/public/css/style.css" rel="stylesheet" />
    <script type="text/javascript" src="/public/js/PageNav.js"></script>
    <script src="/public/js/jquery-1.12.3.min.js"></script>
    <style>
        body{
            background: url(/public/images/bga4.jpg);
            background-size: cover;
        }
    </style>
</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">帝豪酒店管理系统</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/tuichu">退出登录</a></li>
            </ul>

        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li><a href="/admin">房类管理</a></li>
                <li><a href="/admin/fangjianguanli">房间管理</a></li>
                <li><a href="/admin/jiluchaxun">记录查询</a></li>
                <li><a href="/admin/tuifangguanli">退房管理</a></li>
                <li class="active"><a href="/admin/ruzhuguanli">入住管理</a></li>
            </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <h1 class="page-header">入住管理</h1>
            <div class="bs-example bs-example-tabs" style="background:rgba(255,255,255,0.5); padding:20px;">
                <ul id="myTab" class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#daoru"  role="tab" data-toggle="tab" aria-controls="home" aria-expanded="true">大堂入住</a></li>
                    <li role="presentation" class=""><a href="#shengcheng" role="tab"   data-toggle="tab" aria-controls="profile" aria-expanded="false">订单入住</a></li>
                </ul>
                <div id="myTabContent" class="tab-content">
                    <div role="tabpanel" class="tab-pane fade active in" id="daoru" aria-labelledby="home-tab">
                        <div style="background:rgba(255,255,255,0.5); padding:20px;">
                            <table class="table" style="background:rgba(255,255,255,0.5);">
                                <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>房间号</th>
                                    <th>房间类型</th>
                                    <th>房间位置</th>
                                    <th>房间描述</th>
                                    <th>房间状态</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="tbody"></tbody>
                            </table>
                            <div class="row">
                                <div class="col-md-6">
                                    <div id="pagenavbox"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="shengcheng" aria-labelledby="profile-tab">
                        <div style="background:rgba(255,255,255,0.5); padding:20px;">
                            <div class="row">
                                <div class="col-md-2">
                                    <p>
                                        条件查询：
                                    </p>
                                </div>
                                <div class="col-md-4">
                                    <p>
                                        <input type="text" class="form-control" placeholder="请输入房间号" id="searchname">
                                    </p>
                                </div>
                                <div class="col-md-2 col-sm-offset-2">
                                    <p>
                                        <input type="button" class="btn btn-warning"  id="btn" value="入住">
                                    </p>
                                </div>
                            </div>
                        </div>
                        <table class="table" style="background:rgba(255,255,255,0.5);">
                            <thead>
                            <tr>
                                <th>入住时间</th>
                                <th>退房时间</th>
                                <th>入住人</th>
                                <th>联系人</th>
                                <th>证件号</th>
                                <th>性别</th>
                                <th>房间号</th>
                                <th>房间类型</th>
                                <th>入住状态</th>
                                <th>消费金额</th>
                            </tr>
                            </thead>
                            <tbody id="tbody2"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--修改模态框-->
<div class="modal fade" id="myModalChange" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <h4 class="modal-title">添写个人信息</h4>
            </div>
            <div class="modal-body">
                <p id="dingdan">
                </p>
                <p>
                    证件类型：
                    <select name="zhengjianleixing" class="form-control zhengjianleixing">
                        <option value="身份证">身份证</option>
                        <option value="暂住证">暂住证</option>
                    </select>
                </p>
                <p>
                    证件号：
                    <input class="form-control zhengjianhao" type="text"  name="zhengjianhao"/>
                </p>
                <p>
                    姓名：
                    <input class="form-control xingming" type="text"  name="xingming"/>
                </p>
                <p>性别：
                    <select name="sex" class="form-control sex">
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                </p>
                <p>
                    入住日期：
                    <input class="form-control startdate" type="date"  name="startdate"/>
                </p>
                <p>
                    离开日期：
                    <input class="form-control enddate" type="date"  name="enddate"/>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="xiugaiBtn">提交</button>
            </div>
        </div>
    </div>
</div>
<!--弹出的修改课程对话框end-->
<script type="text/javascript" src="/public/js/bootstrap.min.js"></script>
<script>
    //请求一次，创建分页条
    $.get("/admin/fangjianguanli/all?page=1",function(data){
        //分页条
        new PageNav({
            boxid : "pagenavbox",
            page : 1,
            pageAmount : data.pageAmount,
            change : function(pagenumber){
                gotopage(pagenumber);
            }
        });

        gotopage(1);
    });
    //Ajax请求，请求JSON数据
    function gotopage(pagenumber){
        //清空
        $("#tbody").empty();
        //获得新的数据
        $.get("/admin/fangjianguanli/all?page=" + pagenumber,function(data){
            $.each(data.results,function(i, n){
                //创建一个tr标签
                $tr = $("<tr></tr>");
                $("<td></td>").html(i+1).appendTo($tr);
                $("<td></td>").html(n.fangjianhao).appendTo($tr);
                $("<td></td>").html(n.leixing).appendTo($tr);
                $("<td></td>").html(n.weizhi).appendTo($tr);
                $("<td></td>").html(n.miaoshu).appendTo($tr);
                $("<td></td>").html(n.zhuangtai).appendTo($tr);
                if(n.zhuangtai == '已入住'){
                    $("<input type='button' class='btn btn-danger modbtn' value='已入住' data-sid='" + n.fangjianhao + "' disabled data-toggle='modal'  data-target='#myModalChange'/></td>").appendTo($tr);
                }else if(n.zhuangtai == '未入住'){
                    $("<input type='button' class='btn btn-warning modbtn' value='入住' data-sid='" + n.fangjianhao + "' data-toggle='modal'  data-target='#myModalChange'/></td>").appendTo($tr);
                }else if(n.zhuangtai == '预定'){
                    $("<input type='button' class='btn btn-danger modbtn' value='已预定' data-sid='" + n.fangjianhao + "' disabled data-toggle='modal'  data-target='#myModalChange'/></td>").appendTo($tr);
                }
                //上树
                $tr.appendTo($("#tbody"));
            });
        });
    }

    //展示修改页数据
    $("#tbody").delegate(".modbtn","click",function(){
        var sid = $(this).attr("data-sid");
        $.get("/admin/fangjianguanli/updata?sid=" + sid,function (data) {
            var leixing = data.results[0].leixing;
            $.get("/admin/allleibie",function (data) {
                $.each(data.results,function (ind,item) {
                    if(item.name == leixing){
                        $('#dingdan').html(`${sid}房间价格：<span id="jiage">${item.jiage}</span>元`)
                    }
                })

            })
            //添加订单
            $('#xiugaiBtn').click(function () {
                $.post("/user/add", {
                    "jiage":$('#jiage').html(),
                    "zhengjianleixing" : $('#myModalChange select[name=zhengjianleixing]').val(),
                    "zhengjianhao" : $('#myModalChange input[name=zhengjianhao]').val(),
                    "xingming" : $('#myModalChange input[name=xingming]').val(),
                    "sex" : $('#myModalChange select[name=sex]').val(),
                    "fangjianhao" : data.results[0].fangjianhao,
                    "fangjianleixing" : data.results[0].leixing,
                    "username" : $('#username').html(),
                    "startdate":$('#myModalChange input[name=startdate]').val(),
                    "enddate": $('#myModalChange input[name=enddate]').val(),
                    "zt":"已入住"
                }, function (data) {
                    console.log(data);
                    if(data.results == 1){
                        $.post("/admin/fangjianguanli/changezt", {
                            "fangjianhao" : data.fangjianhao,
                        },function (data) {
                            console.log(data);
                            if(data.results == 1){
                                //剩余房间数量
                                $.post("/admin/changefangcount", {
                                    "leixing" : data.leixing,
                                },function (data) {
                                    alert(data);
                                    $("#myModalChange").modal("hide");
                                    // refresh();
                                    window.location="/admin/ruzhuguanli";
                                })
                            }
                        })
                    }else{
                        alert('预定失败')
                    }

                });
            })
        })
    });

    //订单入住
    $('#btn').click(function () {
        var name = $('#searchname').val()
        $.get("/admin/ruzhuguanli/"+name,function (data) {
            alert(data);
            window.location = '/admin/ruzhuguanli';
        })
    })

    //姓名查询
    $('#searchname').on("input",function () {
        $("#tbody").empty();
        $("#pagenavbox").empty();
        var name = $('#searchname').val()
        if(name != ""){
            $.get('/user/searchfanghao/'+name,function (data) {
                console.log(data);
                $.each(data.results,function(i, n){
                    //计算消费金额
                    //1，计算天数
                    var startTime = new Date(n.startdate);
                    var endTime = new Date(n.enddate);
                    var day = (endTime - startTime)/3600/1000/24;
                    //2,价格
                    var zongjie = day * n.jiage;

                    //创建一个tr标签
                    $tr = $("<tr></tr>");
                    $("<td></td>").html(n.startdate).appendTo($tr);
                    $("<td></td>").html(n.enddate).appendTo($tr);
                    $("<td></td>").html(n.xingming).appendTo($tr);
                    $("<td></td>").html(n.xingming).appendTo($tr);
                    $("<td></td>").html(n.zhengjianhao).appendTo($tr);
                    $("<td></td>").html(n.sex).appendTo($tr);
                    $("<td></td>").html(n.fangjianhao).appendTo($tr);
                    $("<td></td>").html(n.fangjianleixing).appendTo($tr);
                    $("<td></td>").html(n.zt).appendTo($tr);
                    $("<td></td>").html(zongjie +"元").appendTo($tr);
                    //上树
                    $tr.appendTo($("#tbody2"));
                });
            })
        }
    })
</script>


</body>
</html>
